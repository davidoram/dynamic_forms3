<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<title>Dynamic_forms3</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}


@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

pre.verseblock-content {
  font-family: inherit;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>Dynamic_forms3</h1>
<span id="author">David Oram</span><br />
<span id="revnumber">version 1.0,</span>
<span id="revdate">2011-09</span>
</div>
<div id="content">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph"><p>The design of dynamic_forms3 (df3)  has been preceded by the authors thought into the attendant problems of
designing, implementing maintaining and enhancing procurement systems, along with the considerable
influence of colleagues at the MSI.</p></div>
</div>
<h2 id="_approach">Approach</h2>
<div class="sectionbody">
<div class="paragraph"><p>df3 takes the approach of separating the tasks of designing a form processing system, which provides forms
that provide a means to capture data into documents.  Documents can be pushed through a workflow
which supports a business process.</p></div>
<div class="paragraph"><p>The initial design does not concern itself with anything beyond these requirements, but that having been said,
the system has been created with the aim of solving problems in the <em>procurement</em> business domain.</p></div>
<h3 id="_modules">Modules</h3><div style="clear:left"></div>
<div class="paragraph"><p>The system is modular with independent modules being responsible for different parts of the system</p></div>
<div class="tableblock">
<table rules="all"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. Modules</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top"> Module          </th>
<th align="left" valign="top"> Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">builder</p></td>
<td align="left" valign="top"><p class="table">Form design</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">compiler</p></td>
<td align="left" valign="top"><p class="table">Compiles the form design, into a static representation that uses the runtime</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">runtime</p></td>
<td align="left" valign="top"><p class="table">Renders forms with their data, retrieving and saving data back to the datastore</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">workflow</p></td>
<td align="left" valign="top"><p class="table">Defines the steps that the information moves through</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">comms</p></td>
<td align="left" valign="top"><p class="table">Interface for external communications with users</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="builder_module">Builder Module</h2>
<div class="sectionbody">
<div class="paragraph"><p>The builder provides the components to build forms interactively or using an API.</p></div>
<h3 id="_data_structures">Data Structures</h3><div style="clear:left"></div>
<div class="paragraph"><p>The data is optimised as to what is required to create pages, and configure the <a href="#runtime_module">[runtime_module]</a>.
The essence is the data structures, data types, and containment relationships.</p></div>
</div>
<h2 id="compiler_module">Compiler Module</h2>
<div class="sectionbody">
<div class="paragraph"><p>Takes the form as built in the builder module &amp; turns it into a different representation such as HTML and javascript
or static PDF</p></div>
</div>
<h2 id="runtime_module">Runtime Module</h2>
<div class="sectionbody">
<div class="paragraph"><p>HTML as created by the <a href="#compiler">[compiler]</a> module uses the JavaScript runtime to maintain the data being edited on the HTML pages.
It knows how to update the HTML correctly as per the users intentions and save the data back to the server.</p></div>
<div class="paragraph"><p>Each procurement round has a number of Forms for capturing the data required at different stages.  Each Form is split
into Sections. Sections have a heading and the various form elements such as text boxes, date pickers and so forth
on them.</p></div>
<div class="paragraph"><p>The system presents the forms as a 2D layout with a viewport that allows the user to see a Section at a time, and
navigate up or down to previous/next section and also right or left to dive into or out of collections of child data.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>+---------------------+
| Section 1           |
|                     |
|                     |
|                     |
|                     |
|                     |
|                     |
+---------------------+----------------------+
| Section 2           | Child 1              |
|                     |                      |
| Children            |                      |
| o Child 1           |                      |
|                     |                      |
|                     |                      |
|                     |                      |
+---------------------+----------------------+
| Section 3           |
|                     |
|                     |
|                     |
|                     |
|                     |
|                     |
+---------------------+</tt></pre>
</div></div>
<div class="paragraph"><p>What the user sees is a View into this through what we call the ViewPort, which allows them to see 1 of these
Sections at a time.  When navigating between the Sections the system animates the movements so as to give the
user a real sense of the physical structure of what they are editing.</p></div>
<div class="paragraph"><p>In this example Child 1 represents a child record that is <em>owned</em> by  the list displayed in Section 2. That list
might have an <em>Add</em> button which would dynamically add Child 2 to the right of Child 1.  Similarly deleting a
Child would remove it.</p></div>
<h3 id="_data_structures_2">Data Structures</h3><div style="clear:left"></div>
<div class="paragraph"><p>df_document stores the document instance data, in JSON format.
It is persisted to and from the permanent document store.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>df_document = {
  _id: 1,
  name: 'Dave',
  dob: '1969-10-22',
  employees: [
    { name: 'Sue', dob: '1970-01-01' },
    { name: 'Bob', dob: '1972-11-03' }
  ]
}</tt></pre>
</div></div>
<div class="paragraph"><p>df_form stores the presentation layout of the forms:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>df_form {
  sections[
    {
      heading: 'Personal details',
      fields: [
        { field: 'name', type: 'string' },
        { field: 'dob', type: 'date'},
      ]
    },
    {
      heading: 'Employee List',
      fields: [
        { field: 'employees[]', type: 'list' },
      ]
    }
    {
      heading: 'Employee',
      fields: [
        { field: 'employees[].name', type: 'string' },
        { field: 'employees[].dob', type: 'date'},
      ]
    }
  ]
}</tt></pre>
</div></div>
<div class="paragraph"><p>When the page is rendered the user is presented with a rendering of the initial section.
Each section renders data within the document at a specific position, gathering all of its data
from the information at that point.</p></div>
<div class="paragraph"><p>The df_document stores information in a containment hierarchy, so the <em>root</em> document contains
fields <em>name</em>, <em>dob</em> and a list of <em>employees</em>.  Each employee is contained within a specific position
within the employees list, ie: employee[0] is Sue, and employee[1] is Bob.</p></div>
<div class="paragraph"><p>When rendering any section the system keeps track of where it is within the hierarchy of the df_document
so that the page knows where to get its data from.  A stack of pointers into the df_document is
maintained in the variable df_document_ptr_stack. The df_document_ptr_stack is initialised with a pointer to the
df_document (root), and if the user navigates to a section that represents a child record, then a
pointer to that specific data item eg: employee[1], is pushed on the df_document_ptr_stack.</p></div>
<div class="paragraph"><p>Whenever a section is rendered, it is passed the top value in the df_document_ptr_stack as its data context,
that it uses to retrieves its data from.</p></div>
<div class="paragraph"><p>The page renderer also evaluates the df_document_ptr stack, and will display a navigation button
( &#8592; ) to return the user from a child record, to the section that displays the list of child records.</p></div>
<div class="paragraph"><p>The section displaying the list of child records participates, by pushing the correct data context onto
the df_document_ptr_stack when the user navigates to a child record.</p></div>
<div class="paragraph"><p>The stack will start empty ie:
  df_document_ptr_stack = [']
which indicates that we are looking at the root of df_document</p></div>
<div class="paragraph"><p>If I have:
  df_document_ptr_stack = [<em>employees[0]</em>]
then I will be working on the first employee child record</p></div>
</div>
<h2 id="workflow_module">Workflow Module</h2>
<div class="sectionbody">
<div class="paragraph"><p>Used to define the steps that the form data travels through, etc</p></div>
</div>
<h2 id="_glossary">Glossary</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
Workflow
</dt>
<dd>
<p>
  TODO
</p>
</dd>
</dl></div>
</div>
<h2 id="_index">Index</h2>
<div class="sectionbody">
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.0<br />
Last updated 2011-10-30 07:53:34 NZDT
</div>
</div>
</body>
</html>
